<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Build an exceedance probability colour map — build_emap • Vizumap</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Build an exceedance probability colour map — build_emap"><meta property="og:description" content="This function builds a map that visualises the probability of exceeding some
nominated threshold of concern."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Vizumap</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/Vizumap.html">Vignette</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/lydialucchesi/Vizumap/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Build an exceedance probability colour map</h1>
    <small class="dont-index">Source: <a href="https://github.com/lydialucchesi/Vizumap/blob/HEAD/R/build_emap.r" class="external-link"><code>R/build_emap.r</code></a></small>
    <div class="hidden name"><code>build_emap.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function builds a map that visualises the probability of exceeding some
nominated threshold of concern.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">build_emap</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  pdflist <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  geoData <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  id <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">key_label</span>,</span>
<span>  palette <span class="op">=</span> <span class="st">"YlOrRd"</span>,</span>
<span>  size <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  border <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>data</dt>
<dd><p>A data frame containing columns that house estimates of the mean,
standard deviation (or margin of error) and exceedance probability (optional).
A number of options are considered for calculating the probability of exceeding
a threshold. See below for more information.</p></dd>


<dt>pdflist</dt>
<dd><p>A list capturing the pdf function that defines the distribution function to use to
calculate the probabilities of exeedence. By default this is NULL and assumes
the exceedance probabilities have been calculated outside of the function and passed
as a third column of the data dataframe.  Functions need to conform to the class
of distribution functions available within R through the <code>stats</code> package.</p></dd>


<dt>geoData</dt>
<dd><p>A spatial polygons data frame.</p></dd>


<dt>id</dt>
<dd><p>Name of the common column shared by the objects passed to
<code>data</code> and <code>geoData</code>. The exceedance probability in the data frame
will be matched to the geographical regions of the spatial polygons data
frame through this column.</p></dd>


<dt>key_label</dt>
<dd><p>Label of legend.</p></dd>


<dt>palette</dt>
<dd><p>Name of colour palette. Colour palette names include
<code>"YlOrBr"</code>, <code>"YlOrRd"</code>, <code>"YlGnBu"</code> and <code>"PuBuGn"</code>.</p></dd>


<dt>size</dt>
<dd><p>An integer between 1 and 20. Value controls the size of points
 when <code>geoData = NULL</code>. If <code>size = NULL</code>, the points will remain
 the default size.</p>
<p>@details An exceedance probability map can be produced using:
 (i) precalculated exceedance probabilities, which are provided as a third column
 to the input dataframe; or
 (ii) exceedance probabilities that are calculated within the function using one of
 the standard probability distributions (e.g. <code>pnorm</code>) provided in the <code>stats</code>
 package in R, or
 (iii) exceedance probabilities that are calculated through a user defined function that
 is passed to the package which conforms to a similar structure as the suite of
 <code>Distributions</code> available in R.  Examples are provided below.</p></dd>


<dt>border</dt>
<dd><p>Name of geographical borders to be added to the map. It must be
one of <code><a href="https://rdrr.io/pkg/maps/man/county.html" class="external-link">county</a></code>, <code><a href="https://rdrr.io/pkg/maps/man/france.html" class="external-link">france</a></code>,
<code><a href="https://rdrr.io/pkg/maps/man/italy.html" class="external-link">italy</a></code>, <code><a href="https://rdrr.io/pkg/maps/man/nz.html" class="external-link">nz</a></code>,
<code><a href="https://rdrr.io/pkg/maps/man/state.html" class="external-link">state</a></code>, <code><a href="https://rdrr.io/pkg/maps/man/usa.html" class="external-link">usa</a></code> or
<code><a href="https://rdrr.io/pkg/maps/man/world.html" class="external-link">world</a></code> (see documentation for
<code><a href="https://ggplot2.tidyverse.org/reference/map_data.html" class="external-link">map_data</a></code> for more information). The borders will be
refined to match latitute and longtidue coordinates provided in the data
frame or spatial polygons data frame.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>If <code>geoData</code> remains <code>NULL</code>, the function will produce a map of
plotted points representing specific sites; in this case, the data frame must
include latitude and longitude coordinates in columns <code>"long"</code> and
<code>"lat"</code>.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">us_data</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">us_geo</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">poverty</span> <span class="op">&lt;-</span> <span class="fu"><a href="read.uv.html">read.uv</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">us_data</span>, estimate <span class="op">=</span> <span class="st">"pov_rate"</span>, error <span class="op">=</span> <span class="st">"pov_moe"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Exceedance probability map: Pr[X &gt; 30] (Exponential Distribution)</span></span></span>
<span class="r-in"><span><span class="co">#---- define probability distribution</span></span></span>
<span class="r-in"><span><span class="va">pd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">pexp</a></span><span class="op">(</span><span class="va">q</span>, <span class="va">rate</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#---- define argument listing</span></span></span>
<span class="r-in"><span><span class="va">args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">estimate</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#---- capture distribution and arguments in a single list</span></span></span>
<span class="r-in"><span><span class="va">pdflist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="va">pd</span>, args <span class="op">=</span> <span class="va">args</span>, th <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu">build_emap</span><span class="op">(</span>data <span class="op">=</span> <span class="va">poverty</span>, pdflist <span class="op">=</span> <span class="va">pdflist</span>, geoData <span class="op">=</span> <span class="va">us_geo</span>, id <span class="op">=</span> <span class="st">"GEO_ID"</span>,</span></span>
<span class="r-in"><span>            border <span class="op">=</span> <span class="st">"state"</span>, key_label <span class="op">=</span> <span class="st">"Pr[X &gt; 30]"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Ensure the pdf you select is suitable for your data. See ??build_emap for examples of good and bad distribution choices.</span>
<span class="r-in"><span><span class="fu"><a href="view.html">view</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Proper use of build_emap (appropriate distribution choice)"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="build_emap-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example where an inappropriate distributions is tried</span></span></span>
<span class="r-in"><span><span class="co"># Exceedance probability map: Pr[X&gt;30] (Normal Distribution)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#---- define probability distribution</span></span></span>
<span class="r-in"><span><span class="va">pd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="va">q</span>, <span class="va">mean</span>, <span class="va">sd</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#---- define argument listing</span></span></span>
<span class="r-in"><span><span class="va">args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">estimate</span>, sd <span class="op">=</span> <span class="va">error</span><span class="op">/</span><span class="fl">1.645</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#---- capture distribution and arguments in a single list</span></span></span>
<span class="r-in"><span><span class="va">pdflist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="va">pd</span>, args <span class="op">=</span> <span class="va">args</span>, th <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu">build_emap</span><span class="op">(</span>data <span class="op">=</span> <span class="va">poverty</span>, pdflist <span class="op">=</span> <span class="va">pdflist</span>, geoData <span class="op">=</span> <span class="va">us_geo</span>, id <span class="op">=</span> <span class="st">"GEO_ID"</span>,</span></span>
<span class="r-in"><span>            border <span class="op">=</span> <span class="st">"state"</span>, key_label <span class="op">=</span> <span class="st">"Pr[X &gt; 30]"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Ensure the pdf you select is suitable for your data. See ??build_emap for examples of good and bad distribution choices.</span>
<span class="r-in"><span><span class="fu"><a href="view.html">view</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Misuse of build_emap (inappropriate distribution choice)"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="build_emap-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example where exceedance probabilities have been supplied (GBR Example)</span></span></span>
<span class="r-in"><span><span class="co"># Load Upper Burdekin Data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">UB</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Build Palette</span></span></span>
<span class="r-in"><span><span class="va">exc_pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="build_palette.html">build_palette</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"usr"</span>, colrange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yellow"</span>, <span class="st">"red"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                                       difC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>                                                       <span class="fu"><a href="view.html">view</a></span><span class="op">(</span><span class="va">exc_pal</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="build_emap-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># Create map and view it</span></span></span>
<span class="r-in"><span><span class="va">tss</span> <span class="op">&lt;-</span> <span class="fu"><a href="read.uv.html">read.uv</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">UB_tss</span>, estimate <span class="op">=</span> <span class="st">"TSS"</span>, error <span class="op">=</span> <span class="st">"TSS Error"</span>, exceedance <span class="op">=</span> <span class="st">"TSS_exc1"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu">build_emap</span><span class="op">(</span>data <span class="op">=</span> <span class="va">tss</span>,  geoData <span class="op">=</span> <span class="va">UB_shp</span>, id <span class="op">=</span> <span class="st">"scID"</span>,</span></span>
<span class="r-in"><span>            key_label <span class="op">=</span> <span class="st">"Pr[TSS &gt; 837mg/L]"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="view.html">view</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="build_emap-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Lydia Lucchesi, Petra Kuhnert.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

